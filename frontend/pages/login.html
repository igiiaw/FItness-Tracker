<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login / Register - FitTrack</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand" href="/index.html">
          <i class="bi bi-lightning-charge-fill"></i> FitTrack
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto align-items-center">
            <li class="nav-item">
              <a class="nav-link" href="/index.html">Home</a>
            </li>
            <div id="authNav" class="nav-group">
              <li class="nav-item">
                <a class="nav-link active" href="/pages/login.html">Login</a>
              </li>
            </div>
            <div id="userNav" class="nav-group" style="display: none">
              <li class="nav-item">
                <a class="nav-link" href="/pages/dashboard.html">Dashboard</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/pages/workouts.html">Workouts</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/pages/exercises.html">Exercises</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/pages/goals.html">Goals</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/pages/progress.html">Progress</a>
              </li>
              <li class="nav-item">
                <a class="nav-link" href="/pages/profile.html">Profile</a>
              </li>
              <li class="nav-item" id="adminNav" style="display: none">
                <a class="nav-link" href="/pages/admin.html">Admin</a>
              </li>
              <li class="nav-item ms-2">
                <span class="nav-link" style="color: var(--info) !important">
                  <i class="bi bi-person-circle"></i>
                  <span id="navUsername"></span>
                </span>
              </li>
              <li class="nav-item">
                <button class="btn btn-outline-light btn-sm ms-2" onclick="logout()">Logout</button>
              </li>
            </div>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Login Form -->
    <div class="auth-container" id="loginSection">
      <div class="card">
        <h2>Welcome Back</h2>
        <p class="subtitle">Log in to your FitTrack account</p>

        <div id="loginError" class="alert alert-danger" style="display: none"></div>

        <form id="loginForm">
          <div class="mb-3">
            <label for="loginEmail" class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              id="loginEmail"
              placeholder="Enter your email"
              required
            />
          </div>
          <div class="mb-3">
            <label for="loginPassword" class="form-label">Password</label>
            <input
              type="password"
              class="form-control"
              id="loginPassword"
              placeholder="Enter your password"
              required
            />
          </div>
          <button type="submit" class="btn btn-primary w-100 mb-3">
            Login
          </button>
        </form>

        <p class="text-center text-muted">
          Don't have an account?
          <a href="#" onclick="showRegister()" class="text-decoration-none">Register</a>
        </p>
      </div>
    </div>

    <!-- Register Form -->
    <div class="auth-container" id="registerSection" style="display: none">
      <div class="card">
        <h2>Create Account</h2>
        <p class="subtitle">Sign up to start tracking your fitness</p>

        <div id="registerError" class="alert alert-danger" style="display: none"></div>

        <form id="registerForm">
          <div class="mb-3">
            <label for="regUsername" class="form-label">Username</label>
            <input
              type="text"
              class="form-control"
              id="regUsername"
              placeholder="Choose a username"
              required
              minlength="3"
            />
          </div>
          <div class="mb-3">
            <label for="regEmail" class="form-label">Email</label>
            <input
              type="email"
              class="form-control"
              id="regEmail"
              placeholder="Enter your email"
              required
            />
          </div>
          <div class="mb-3">
            <label for="regPassword" class="form-label">Password</label>
            <input
              type="password"
              class="form-control"
              id="regPassword"
              placeholder="Min 6 characters"
              required
              minlength="6"
            />
          </div>
          <button type="submit" class="btn btn-primary w-100 mb-3">
            Register
          </button>
        </form>

        <p class="text-center text-muted">
          Already have an account?
          <a href="#" onclick="showLogin()" class="text-decoration-none">Login</a>
        </p>
      </div>
    </div>

    <!-- Footer -->
    <footer>
      <div class="container">
        <p class="mb-0">&copy; 2025 FitTrack. All rights reserved.</p>
      </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/js/app.js"></script>
    <script>
      // If already logged in, redirect to dashboard
      if (isLoggedIn()) {
        window.location.href = "/pages/dashboard.html";
      }

      // Switch between login and register
      function showRegister() {
        document.getElementById("loginSection").style.display = "none";
        document.getElementById("registerSection").style.display = "block";
      }

      function showLogin() {
        document.getElementById("registerSection").style.display = "none";
        document.getElementById("loginSection").style.display = "block";
      }

      // Check hash for register
      if (window.location.hash === "#register") {
        showRegister();
      }

      // Login handler
      document.getElementById("loginForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        var errorDiv = document.getElementById("loginError");
        errorDiv.style.display = "none";

        var email = document.getElementById("loginEmail").value;
        var password = document.getElementById("loginPassword").value;

        try {
          var data = await apiRequest("/auth/login", "POST", { email: email, password: password });
          setToken(data.token);
          setUser(data.user);
          window.location.href = "/pages/dashboard.html";
        } catch (err) {
          errorDiv.textContent = err.message;
          errorDiv.style.display = "block";
        }
      });

      // Register handler
      document.getElementById("registerForm").addEventListener("submit", async function (e) {
        e.preventDefault();
        var errorDiv = document.getElementById("registerError");
        errorDiv.style.display = "none";

        var username = document.getElementById("regUsername").value;
        var email = document.getElementById("regEmail").value;
        var password = document.getElementById("regPassword").value;

        try {
          var data = await apiRequest("/auth/register", "POST", {
            username: username,
            email: email,
            password: password,
          });
          setToken(data.token);
          setUser(data.user);
          window.location.href = "/pages/dashboard.html";
        } catch (err) {
          errorDiv.textContent = err.message;
          errorDiv.style.display = "block";
        }
      });
    </script>
  </body>
</html>
